{% extends "layouts/client.html" %}

{% block title %}Project - EcoVision{% endblock %}

{% block head %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/trading/project.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/trading/dashboardmain.css') }}" />

  <script>
    tinymce.init({
      selector: 'textarea#content',
      plugins: 'anchor autolink image link lists media searchreplace table wordcount',
      toolbar: 'undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | link image media table mergetags | align lineheight | tinycomments | checklist numlist bullist indent outdent | emoticons charmap | removeformat'
    });
  </script>
{% endblock %}

{% block content %}
<div id="content">
  <div class="Header">
    <h1>{{project.type}} project by {{project.name}}</h1>
    <hr>
    <a href="{{url_for('trading.home')}}" class="link">Back To Projects</a>
    <hr>
  </div>

  <div class="Carosell">
    <div id="myCarousel" class="carousel slide" data-ride="carousel">
        <div id="carouselinner" class="carousel-inner">

          <!-- Images will be added dynamically here -->
          {% for carousel in project.carousel %}
            <div class="carousel-item">
              <img class="d-block w-100" src="{{ carousel }}">
            </div>
          {% endfor %}

          <script>
            document.getElementById("carouselinner").querySelector('div:first-child').classList.add('active');
          </script>
        </div>
        <a class="carousel-control-prev" href="#myCarousel" data-slide="prev">
            <span class="carousel-control-prev-icon"></span>
        </a>
        <a class="carousel-control-next" href="#myCarousel" data-slide="next">
            <span class="carousel-control-next-icon"></span>
        </a>
    </div>
    {% if current_user.type == "admin" or current_user.type == "author" %}
      <div class="container mt-3">
        <form action="{{ url_for('trading.project_addimg', project=project.id) }}" method="POST">
          <div class="form-group">
              <label for="imageUrl">Image URL:</label>
              <input type="text" class="form-control" name="imageUrl" id="imageUrl" placeholder="Enter image URL">
          </div>
          <button type="submit" class="btn btn-primary" id="addImageBtn">Add Image</button>
        </form>
      </div>
    {% endif %}
    
    </body>

  </div>

  <div class="details">
    <div class="post-content">
      <div>
        <div class='left-side'>
          {{ project.content | safe }}
        </div>
      </div>

      <div class="right-side">
        <div class="cart">
          <div class="Cart-des1">
            <p><b> ${{project.price}} </b>/tonne</p>
            <p>Carbon offset per stock : 1 CO2e
            <br>Total amount of stock : {{project.stock}} </p>
          </div>

          <br>

          <div class="Cart-des2">
            <form id="purchaseForm" action="{{ url_for('trading.purchase', project=project.id) }}" method="POST">
              <div>
                <p class="quantity">Quantity</p>
                <!-- Button trigger modal -->
                <p class="stock">{{ formCart.stock }}</p>
                <button type="button" class="buy-btn" data-toggle="modal" data-target="#confirmModal">
                  Buy
                </button>
                <br> 
              </div>
              
              <!-- Modal -->
              <div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="confirmModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
  
                      <div class="modal-header">
                        <h5 class="modal-title" id="confirmModalLabel">Confirm Carbon Credit Purchase</h5>
                      </div>
                      <div class="modal-footer">
                        {{ formCart.csrf_token }}
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Confirm</button>
                      </div>
  
                  </div>
                </div>
              </div>

            </form>

          </div>
        </div>

      </div>

    </div>

    {% if current_user.type == "admin" or current_user.type == "author" %}
    <div>
      <div class="Editior">
        <form method="POST">
          {{ form.hidden_tag() }}
      
          <h2>
            Edit Project Details
          </h2>
          <div class="save">
            <input type="submit" value="Save">
          </div>
          <textarea name="content" id="content" cols="30" rows="30" placeholder="Content">{{ project.content }}</textarea>
      
          <div class="form-footer">
            <div class="status-message" style="display: inline-block;">
              {% if status_message != none %}{{status_message}}{% endif %}</div>
          </div>
        </form>
      </div>
    {% endif %}
  </div>


  <div class="View">
    <a href="{{url_for('trading.home')}}" class="link">Back To Projects</a>
    <br>

    <div class="view-projects">
      <hr>
      <P>Discover more projects right now!</P>
      <hr>
    </div>

    {% for project in projects.values() %}
      <div class="project">
        <div class="methaneP">
          <div class="image-container">
            <img src="../../static/images/{{ project.type }}.jpg" alt="Your Image">
            <div class="text-overlay">
                <h2>{{ project.type }} | {{ project.name }}</h2>
                <p>Stock: {{ project.stock }} Price(SGD): {{ project.price }}</p>
                <p><a href="{{ url_for('trading.project', project=project.id) }}" class="project-link">View Project</a></p>
            </div>
          </div>
          <p><a href="{{ url_for('trading.project', project=project.id) }}" class="view-link" >View project now</a> <br> <B> {{ project.type }} </B> </p>
        </div>
      </div>
    {% endfor %}
  </div>
</div>
{% endblock%}
